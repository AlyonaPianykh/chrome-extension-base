<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Cat Image Viewer</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        #canvas-container {
            margin: 20px auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background-color: white;
        }
        canvas {
            display: block;
        }
        #refresh-btn {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 12px 24px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 10px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        #refresh-btn:hover {
            background-color: #45a049;
        }
        #loading {
            margin: 20px;
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>
<h1>Random Cat Image Viewer</h1>
<div id="canvas-container">
    <canvas id="catCanvas" width="600" height="400"></canvas>
</div>
<div id="loading">Loading cat image...</div>
<button id="refresh-btn">Get New Cat</button>

<script>
    // Get DOM elements
    const canvas = document.getElementById('catCanvas');
    const ctx = canvas.getContext('2d');
    const refreshBtn = document.getElementById('refresh-btn');
    const loadingText = document.getElementById('loading');

    // Variables for animation
    let catImage = null;
    let isLoading = true;
    let fadeInProgress = 0;
    let animationId = null;

    // Function to fetch a new cat image
    async function fetchCatImage() {
        // Show loading text and reset animation
        loadingText.style.display = 'block';
        isLoading = true;
        fadeInProgress = 0;

        // Cancel any ongoing animation
        if (animationId) {
            cancelAnimationFrame(animationId);
        }

        // Clear the canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        try {
            const timestamp = new Date().getTime();
            const imageUrl = `https://cataas.com/cat?${timestamp}`;

            const img = new Image();
            const imageLoadPromise = new Promise((resolve, reject) => {
                img.onload = () => resolve(img);
                img.onerror = () => reject(new Error('Failed to load cat image'));
            });

            img.crossOrigin = "anonymous";
            img.src = imageUrl;
            catImage = await imageLoadPromise;
            isLoading = false;
            loadingText.style.display = 'none';
            animateImage();

        } catch (error) {
            console.error('Error fetching cat image:', error);
            loadingText.textContent = 'Failed to load cat image. Please try again.';
        }
    }

    function animateImage() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (catImage) {
            const aspectRatio = catImage.width / catImage.height;
            let drawWidth, drawHeight;

            if (canvas.width / canvas.height > aspectRatio) {
                drawHeight = canvas.height;
                drawWidth = drawHeight * aspectRatio;
            } else {
                drawWidth = canvas.width;
                drawHeight = drawWidth / aspectRatio;
            }

            const x = (canvas.width - drawWidth) / 2;
            const y = (canvas.height - drawHeight) / 2;

            if (fadeInProgress < 1) {
                ctx.globalAlpha = fadeInProgress;
                fadeInProgress += 0.05;
            }

            ctx.drawImage(catImage, x, y, drawWidth, drawHeight);
            ctx.globalAlpha = 1;

            if (fadeInProgress < 1) {
                animationId = requestAnimationFrame(animateImage);
            }
        }
    }

    refreshBtn.addEventListener('click', fetchCatImage);

    fetchCatImage();
</script>
</body>
</html>